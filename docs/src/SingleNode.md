# Local Single Node Setup

The single node setup allows for local classification of I/O requests. This standalone process requires no server or any kind of running database. Additionally, no changes to the binary or workflow are required.

## Creating a performance model

After compiling, the performance model can be generated by running `blackheap`. No further configuration is required.

One should run the benchmarks on the same decice as the program which one wants to analyze. The path used can be speicifed via the `--file` parameter, see `blackheap --help` for more information.

## Analyzing the created model

After running `blackheap`, a model folder will be created. The default path is `./default-model`, although this can be changed via the `--to` parameter.

In this folder, the single file web-frontend is contained, named `index.html`. This can be viewed with any device and any modern browser; no extra webserver is required. After loading the `Model.json`, the analyzed data gets plotted for manual analysis.

## Using the created model locally

In order to locally measure any I/O requests, we preload custom I/O functions interjecting any I/O requests. Those I/O functions trace the time taken for each operation.

This is done via the `LD_PRELOAD` environment variable. [The Linux manual](https://man7.org/linux/man-pages/man8/ld-linux.so.8.html) defines it as follows:

"A list of additional, user-specified, ELF shared objects to be loaded before all others. This feature can be used to selectively override functions in other shared objects."

For a great, introduction, see ["The `LD_PRELOAD` trick"](http://www.goldsborough.me/c/low-level/kernel/2016/08/29/16-48-53-the_-ld_preload-_trick/).

Our preloadee can be found under `./preloadee`. It can be built via `make`.

Afterwards, the measurements are done by running the to-be-analyzed binary with the preloaded library injected, i.e.

```
LD_PRELOAD=./build/preloadee.so /path/to/my/program
```

This will produce [a CSV file](./FileFormats.md) in the current working directory. This file can then be analyzed locally via the aforementioned web-frontend.
